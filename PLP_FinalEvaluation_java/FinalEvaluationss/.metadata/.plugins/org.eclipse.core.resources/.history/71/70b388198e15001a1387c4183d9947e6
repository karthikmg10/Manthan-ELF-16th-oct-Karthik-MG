package com.manthan.resumefinder.servlets;

import java.io.File;
import java.io.IOException;
import java.io.InputStream;
import java.util.List;

import javax.servlet.ServletException;
import javax.servlet.annotation.MultipartConfig;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.Part;

import org.apache.commons.fileupload.disk.DiskFileItemFactory;



@WebServlet("/UploadResume")
@MultipartConfig
public class Uploadresume<ServletFileUpload> extends HttpServlet {
	private final String UPLOAD_DIRECTORY = "D:\\FinalEvaluation\\Project";
	 
	 
	 @Override
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		 if(ServletFileUpload.isMultipartContent(request)){
			 DiskFileItemFactory factory = new DiskFileItemFactory();
		        factory.setRepository(new File(System.getProperty("java.io.tmpdir")));

		        ServletFileUpload upload = new ServletFileUpload(factory);


		        // constructs the directory path to store upload file
		        // this path is relative to application's directory
		        String uploadPath = getServletContext().getRealPath("")+ File.separator + UPLOAD_DIRECTORY;

		        // creates the directory if it does not exist
		        File uploadDir = new File(uploadPath);
		        if (!uploadDir.exists()) {
		            uploadDir.mkdir();
		        }

		        
	            try {
	            	Part filePart = request.getPart("file"); // Retrieves <input type="file" name="file">
	            	InputStream filecontent = filePart.getInputStream();
				/*
				 * List<FileItem> multiparts = new ServletFileUpload(new
				 * DiskFileItemFactory()).parseRequest((RequestContext) request);
				 * 
				 * for(FileItem item : multiparts){ if(!item.isFormField()){ String name = new
				 * File(item.getName()).getName(); item.write( new File(UPLOAD_DIRECTORY +
				 * File.separator + name)); } }
				 */
	            
	               //File uploaded successfully
	               request.setAttribute("message", "File Uploaded Successfully");
	               //request.getRequestDispatcher("/res").forward(request, response);
	            } catch (Exception ex) {
	               request.setAttribute("message", "File Upload Failed due to " + ex);
	               //request.getRequestDispatcher("/res").forward(request, response);
	            }          
	          
	        }else{
	            request.setAttribute("message",
	                                 "Sorry this Servlet only handles file upload request");
	           // request.getRequestDispatcher("/res").forward(request, response);
	        }
	     
	        request.getRequestDispatcher("/ResultResume").forward(request, response);
	      
	    }

}
  

