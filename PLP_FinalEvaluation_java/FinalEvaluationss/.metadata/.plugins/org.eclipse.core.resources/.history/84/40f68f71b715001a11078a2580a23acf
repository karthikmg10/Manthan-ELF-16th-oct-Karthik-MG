package com.manthan.resumefinder.servlets;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileReader;
import java.util.StringTokenizer;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;

import org.apache.tika.metadata.Metadata;
import org.apache.tika.parser.ParseContext;
import org.apache.tika.parser.pdf.PDFParser;
import org.apache.tika.sax.BodyContentHandler;

@WebServlet("/SearchResume")
public class SearchResume extends HttpServlet {
	
	 public static void main(String[] args) throws Exception {
	      BodyContentHandler handler = new BodyContentHandler();
	      Metadata metadata = new Metadata();
	      FileInputStream inputstream = new FileInputStream(new File("D:/Resume/madhusudansahu.pdf"));
	      
	      ParseContext pcontext = new ParseContext();
	      //parsing the document using PDF parser
	      PDFParser pdfparser = new PDFParser();
	      pdfparser.parse(inputstream, handler, metadata,pcontext);
	      String content = handler.toString();
	      
	      String pattern = "(.*)(\\d+)(.*)"; ////REGEX for getting address

	      Pattern p = Pattern.compile("(0/91)?[7-9][0-9]{9}"); //REGEX for getting mobile number

	      Matcher found = p.matcher(content);

	      if (found.find( )) {
	         // System.out.println("Start index: " + found.start());
	          //System.out.println(" End index: " + found.end() + " ");
	          String mobile=found.group();
	          System.out.println("Mobile -------------> "+mobile);

	       } else {
	          System.out.println("NO MATCH");
	       }

	      Pattern address=Pattern.compile(pattern);
	      Matcher m=address.matcher(content);
	      if(m.find())
	      {
	          String fullAddress = m.group(0);
	          System.out.println("address------------->"+fullAddress);
	      }
	      Pattern email=Pattern.compile("([a-zA-Z0-9\\+\\.\\_\\%\\-\\+]{1,256}\\@[a-zA-Z0-9][a-zA-Z0-9\\-]{0,64}(\\.[a-zA-Z0-9][a-zA-Z0-9\\-]{0,25})+)");
	      Matcher mail=email.matcher(content);
	      if(mail.find())
	      {
	          String emailAdd = mail.group(0);
	          System.out.println("Email Address----> "+emailAdd);
	      }
	      else {
	          System.out.println("NO MATCH");
	       }


	      StringTokenizer st=new StringTokenizer("sdgsg sgsdgdsg  Worked at ", "\n");
	      while(st.hasMoreTokens()) { 
	          String key = st.nextToken(); 
	          //String val = st.nextToken(); 
	          System.out.println(key + "\t" ); 
	          } 

	      //getting the content of the document
	    //  System.out.println("Contents of the PDF :" + content);

	      //getting metadata of the document
	    //  System.out.println("Metadata of the PDF:");
	      String[] metadataNames = metadata.names();

	    /*  for(String name : metadataNames) {
	         System.out.println(name+ " : " + metadata.get(name));
	      }*/
	   } 

}
